namespace: bus-booking

services:
  gateway-service:
    containerName: gateway-service
    image: npkhang22/bb-gateway-service
    tag: gateway-service-c5d0e57
    port: 8000
    env:
      SERVER_PORT: "8000"
      REDIS_DB: "4"
      USER_SERVICE_URL: "http://user-service"
      TRIP_SERVICE_URL: "http://trip-service"
      BOOKING_SERVICE_URL: "http://booking-service"
      VERIFY_ENDPOINT: "/api/v1/auth/verify-token"
    ingress:
      enabled: true
      host: bus-booking.site
      path: "/"

  user-service:
    containerName: user-service
    image: npkhang22/bb-user-service
    tag: user-service-3ab4224
    port: 8080
    env:
      DATABASE_NAME: "bus_booking_user"
      SERVER_PORT: "8080"
      REDIS_DB: "0"
    ingress:
      enabled: false # Traffic goes through gateway now

  trip-service:
    containerName: trip-service
    image: npkhang22/bb-trip-service
    tag: trip-service-2c309ad
    port: 8081
    env:
      DATABASE_NAME: "bus_booking_trip"
      SERVER_PORT: "8081"
      REDIS_DB: "1"
    ingress:
      enabled: false # Traffic goes through gateway now

  booking-service:
    containerName: booking-service
    image: npkhang22/bb-booking-service
    tag: booking-service-248f889
    port: 8082
    env:
      DATABASE_NAME: "bus_booking_booking"
      SERVER_PORT: "8082"
      REDIS_DB: "2"
    ingress:
      enabled: false # Traffic goes through gateway now

# Environment Variables
env:
  # Server
  GIN_MODE: "release"
  LOG_LEVEL: info
  LOG_FORMAT: console
  LOG_OUTPUT: stdout
  LOG_FILENAME: logs/app.log
  LOG_MAX_SIZE: 100
  LOG_MAX_BACKUPS: 3
  LOG_MAX_AGE: 30
  LOG_COMPRESS: true

  SERVER_HOST: "0.0.0.0"
  SERVER_READ_TIMEOUT: "10s"
  SERVER_WRITE_TIMEOUT: "10s"
  SERVER_IDLE_TIMEOUT: "120s"
  SERVER_SHUTDOWN_TIMEOUT: "30s"
  SERVER_MAX_HEADER_BYTES: "1048576"
  SERVER_ENVIRONMENT: "production"

  # Rate Limiting Configuration
  RATE_LIMIT_RPS: 100
  RATE_LIMIT_BURST: 200
  RATE_LIMIT_PERIOD: 1m
  RATE_LIMIT_CLEANUP_AFTER: 10m

  # CORS
  CORS_ALLOWED_ORIGINS: "https://bus-booking.site"
  CORS_ALLOWED_METHODS: "GET,POST,PUT,DELETE,OPTIONS"
  CORS_ALLOWED_HEADERS: "Origin,Content-Type,Accept,Authorization,X-Requested-With"
  CORS_ALLOW_CREDENTIALS: "true"
  CORS_MAX_AGE: "86400"

  # Database
  DATABASE_HOST: bus-booking-database-do-user-29228381-0.d.db.ondigitalocean.com
  DATABASE_PORT: 25060
  DATABASE_USERNAME: doadmin
  DATABASE_PASSWORD: AVNS_k8dv8ULBQ3Sjwie2_Xe
  DATABASE_SSL_MODE: require
  DATABASE_TIMEZONE: Asia/Ho_Chi_Minh
  DATABASE_MAX_OPEN_CONNS: 25
  DATABASE_MAX_IDLE_CONNS: 5
  DATABASE_CONN_MAX_LIFETIME: 300s
  DATABASE_CONN_MAX_IDLE_TIME: 60s

  # Redis
  REDIS_HOST: singapore-keyvalue.render.com
  REDIS_PORT: 6379
  REDIS_USERNAME: red-d4ebsr7pm1nc738oor50
  REDIS_PASSWORD: MJm32AjPDJoT1sMS9ug2BwzxOU7aayCZ
  REDIS_TLS: true
  REDIS_POOL_SIZE: 5
  REDIS_MIN_IDLE_CONNS: 1
  REDIS_MAX_RETRIES: 3
  REDIS_DIAL_TIMEOUT: 10s
  REDIS_READ_TIMEOUT: 10s
  REDIS_WRITE_TIMEOUT: 10s

  # JWT
  JWT_SECRET_KEY: dbe13e045840e8fa98e7ad3f0996533e71d609decca7d491f4a416b67b313111
  JWT_REFRESH_SECRET_KEY: d9bcfbb01e0914874ca4dcef7b6b8179c51988771e1326fc3a64781265596500
  JWT_ACCESS_TOKEN_TTL: 15m
  JWT_REFRESH_TOKEN_TTL: 168h
  JWT_ISSUER: bus-booking-system
  JWT_AUDIENCE: bus-booking-users

  # Logging Configuration
  EXTERNAL_PAYMENT_SERVICE_URL: https://payment-service
  EXTERNAL_NOTIFICATION_URL: https://notification-service
  EXTERNAL_TIMEOUT: 30s
  EXTERNAL_RETRY_ATTEMPTS: 3

  # Firebase Configuration
  FIREBASE_SERVICE_ACCOUNT_KEY_PATH: ./config/fbsvc.json
  FIREBASE_USE_SERVICE_ACCOUNT_FILE: true
