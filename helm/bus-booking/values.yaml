namespace: bus-booking

services:
  gateway-service:
    containerName: gateway-service
    image: npkhang22/bb-gateway-service
    tag: gateway-service-3ed5cb1
    port: 8080
    env:
      SERVICE_NAME: 'gateway-service'
      SERVER_PORT: '8080'
      REDIS_DB: '4'

      AUTH_USER_SERVICE_URL: 'http://user-service'
      AUTH_VERIFY_ENDPOINT: '/api/v1/auth/verify-token'

      SERVICES_USER_URL: 'http://user-service'
      SERVICES_USER_TIMEOUT: '60'
      SERVICES_USER_RETRIES: '3'

      SERVICES_TRIP_URL: 'http://trip-service'
      SERVICES_TRIP_TIMEOUT: '60'
      SERVICES_TRIP_RETRIES: '3'

      SERVICES_BOOKING_URL: 'http://booking-service'
      SERVICES_BOOKING_TIMEOUT: '60'
      SERVICES_BOOKING_RETRIES: '3'

      SERVICES_PAYMENT_URL: 'http://payment-service'
      SERVICES_PAYMENT_TIMEOUT: '60'
      SERVICES_PAYMENT_RETRIES: '3'

      SERVICES_CHATBOT_URL: 'http://chatbot-service'
      SERVICES_CHATBOT_TIMEOUT: '60'
      SERVICES_CHATBOT_RETRIES: '3'
    ingress:
      enabled: true
      host: bus-booking.site
      path: '/'

  user-service:
    containerName: user-service
    image: npkhang22/bb-user-service
    tag: user-service-b16941d
    port: 8080
    env:
      SERVICE_NAME: 'user-service'
      DATABASE_NAME: 'bus_booking_user'
      SERVER_PORT: '8080'
      REDIS_DB: '0'
    ingress:
      enabled: false

  trip-service:
    containerName: trip-service
    image: npkhang22/bb-trip-service
    tag: trip-service-5cdef0d
    port: 8080
    env:
      SERVICE_NAME: 'trip-service'
      DATABASE_NAME: 'bus_booking_trip'
      SERVER_PORT: '8080'
      REDIS_DB: '1'
    ingress:
      enabled: false # Traffic goes through gateway now

  booking-service:
    containerName: booking-service
    image: npkhang22/bb-booking-service
    tag: booking-service-39a2a9f
    port: 8080
    env:
      SERVICE_NAME: 'booking-service'
      DATABASE_NAME: 'bus_booking_booking'
      SERVER_PORT: '8080'
      REDIS_DB: '2'
    ingress:
      enabled: false # Traffic goes through gateway now

  payment-service:
    containerName: payment-service
    image: npkhang22/bb-payment-service
    tag: payment-service-b16941d
    port: 8080
    env:
      SERVICE_NAME: 'payment-service'
      DATABASE_NAME: 'bus_booking_payment'
      SERVER_PORT: '8080'
      REDIS_DB: '3'

      PAYOS_CLIENT_ID: ce924919-6874-43ce-88fb-068b5e73988a
      PAYOS_API_KEY: 8d37f38e-f028-47c4-aa41-12674bf16328
      PAYOS_CHECKSUM_KEY: e01cb1038e2744ea9e479dc460dc80c91aff7e0b18d9a1431808f78e45dcde91
      PAYOS_RETURN_URL: https://csc13114-bus-booking-system.vercel.app/payment/success
      PAYOS_CANCEL_URL: https://csc13114-bus-booking-system.vercel.app/payment/cancel
    ingress:
      enabled: false # Traffic goes through gateway now

  notification-service:
    containerName: notification-service
    image: npkhang22/bb-notification-service
    tag: notification-service-c2940d0
    port: 8080
    env:
      SERVICE_NAME: 'notification-service'

      BREVO_API_KEY: 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
      FROM_EMAIL: npkhang287@gmail.com
      FROM_NAME: Bus Booking System

      TEMPLATE_PATH: templates
      LOGO_URL: https://csc13114-bus-booking-system.vercel.app/_next/image?url=%2Ffavicon.png&w=128&q=75
    ingress:
      enabled: false # Traffic goes through gateway now

  chatbot-service:
    containerName: chatbot-service
    image: npkhang22/bb-chatbot-service
    tag: chatbot-service-b16941d
    port: 8080
    env:
      SERVICE_NAME: 'chatbot-service'
      SERVER_PORT: '8080'
      REDIS_DB: '5'

      # Gemini Config
      GEMINI_API_KEY: 'AIzaSyBV4q_feaSxmup1ar8xn87WWNgKFd5BbQM'
      GEMINI_MODEL: 'gemini-2.5-flash'
      GEMINI_TEMPERATURE: '0.7'
      GEMINI_MAX_TOKENS: '2048'
    ingress:
      enabled: false

# Environment Variables
env:
  # Server
  GIN_MODE: 'release'
  LOG_LEVEL: info
  LOG_FORMAT: console
  LOG_OUTPUT: stdout
  LOG_FILENAME: logs/app.log
  LOG_MAX_SIZE: 100
  LOG_MAX_BACKUPS: 3
  LOG_MAX_AGE: 30
  LOG_COMPRESS: true

  SERVER_HOST: '0.0.0.0'
  SERVER_READ_TIMEOUT: '60s'
  SERVER_WRITE_TIMEOUT: '60s'
  SERVER_IDLE_TIMEOUT: '120s'
  SERVER_SHUTDOWN_TIMEOUT: '30s'
  SERVER_MAX_HEADER_BYTES: '1048576'
  SERVER_ENVIRONMENT: 'production'

  # Rate Limiting Configuration
  RATE_LIMIT_RPS: 100
  RATE_LIMIT_BURST: 200
  RATE_LIMIT_PERIOD: 1m
  RATE_LIMIT_CLEANUP_AFTER: 10m

  # CORS
  CORS_ALLOWED_ORIGINS: 'https://csc13114-bus-booking-system.vercel.app,http://localhost:3000,https://api-merchant.payos.vn'
  CORS_ALLOWED_METHODS: 'GET,POST,PUT,PATCH,DELETE,OPTIONS'
  CORS_ALLOWED_HEADERS: 'Origin,Content-Type,Accept,Authorization,X-Requested-With,X-User-ID,X-User-Role,X-Access-Token'
  CORS_ALLOW_CREDENTIALS: 'true'
  CORS_MAX_AGE: '86400'

  # Database
  DATABASE_HOST: bus-booking-database-do-user-29228381-0.d.db.ondigitalocean.com
  DATABASE_PORT: 25060
  DATABASE_USERNAME: doadmin
  DATABASE_PASSWORD: AVNS_k8dv8ULBQ3Sjwie2_Xe
  DATABASE_SSL_MODE: require
  DATABASE_TIMEZONE: Asia/Ho_Chi_Minh
  DATABASE_MAX_OPEN_CONNS: 25
  DATABASE_MAX_IDLE_CONNS: 5
  DATABASE_CONN_MAX_LIFETIME: 300s
  DATABASE_CONN_MAX_IDLE_TIME: 60s
  DATABASE_ENVIRONMENT: production

  # Redis
  REDIS_HOST: singapore-keyvalue.render.com
  REDIS_PORT: 6379
  REDIS_USERNAME: red-d4ebsr7pm1nc738oor50
  REDIS_PASSWORD: MJm32AjPDJoT1sMS9ug2BwzxOU7aayCZ
  REDIS_TLS: true
  REDIS_POOL_SIZE: 5
  REDIS_MIN_IDLE_CONNS: 1
  REDIS_MAX_RETRIES: 3
  REDIS_DIAL_TIMEOUT: 60s
  REDIS_READ_TIMEOUT: 60s
  REDIS_WRITE_TIMEOUT: 60s

  # JWT
  JWT_SECRET_KEY: dbe13e045840e8fa98e7ad3f0996533e71d609decca7d491f4a416b67b313111
  JWT_REFRESH_SECRET_KEY: d9bcfbb01e0914874ca4dcef7b6b8179c51988771e1326fc3a64781265596500
  JWT_ACCESS_TOKEN_TTL: 15m
  JWT_REFRESH_TOKEN_TTL: 168h
  JWT_ISSUER: bus-booking-system
  JWT_AUDIENCE: bus-booking-users

  # Logging Configuration
  EXTERNAL_NOTIFICATION_SERVICE_URL: http://notification-service
  EXTERNAL_BOOKING_SERVICE_URL: http://booking-service
  EXTERNAL_PAYMENT_SERVICE_URL: http://payment-service
  EXTERNAL_TRIP_SERVICE_URL: http://trip-service
  EXTERNAL_USER_SERVICE_URL: http://user-service
  EXTERNAL_TIMEOUT: 60s
  EXTERNAL_RETRY_ATTEMPTS: 3

  # Firebase Configuration
  FIREBASE_SERVICE_ACCOUNT_KEY_PATH: config/fbsvc.json
  FIREBASE_USE_SERVICE_ACCOUNT_FILE: true
