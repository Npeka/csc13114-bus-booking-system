apiVersion: v1
kind: Secret
metadata:
  name: {{ include "bus-booking.fullname" . }}-secret
  namespace: {{ .Values.namespace | default "default" }}
  labels:
    {{- include "bus-booking.labels" . | nindent 4 }}
type: Opaque
data:
  # JWT Secrets
  jwt-secret-key: {{ .Values.env.jwt.JWT_SECRET_KEY | b64enc | quote }}
  jwt-refresh-secret-key: {{ .Values.env.jwt.JWT_REFRESH_SECRET_KEY | b64enc | quote }}

  # Database Secrets
  database-password: {{ .Values.externalDatabase.postgresql.password | b64enc | quote }}

  # Redis Secrets (if password is set)
  {{- if .Values.externalDatabase.redis.password }}
  redis-password: {{ .Values.externalDatabase.redis.password | b64enc | quote }}
  {{- end }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "bus-booking.fullname" . }}-config
  labels:
    {{- include "bus-booking.labels" . | nindent 4 }}
data:
  # Global Server Configuration
  SERVER_HOST: {{ .Values.env.global.SERVER_HOST | quote }}
  SERVER_ENVIRONMENT: {{ .Values.env.global.SERVER_ENVIRONMENT | quote }}
  SERVER_READ_TIMEOUT: {{ .Values.env.global.SERVER_READ_TIMEOUT | quote }}
  SERVER_WRITE_TIMEOUT: {{ .Values.env.global.SERVER_WRITE_TIMEOUT | quote }}
  SERVER_IDLE_TIMEOUT: {{ .Values.env.global.SERVER_IDLE_TIMEOUT | quote }}
  SERVER_SHUTDOWN_TIMEOUT: {{ .Values.env.global.SERVER_SHUTDOWN_TIMEOUT | quote }}
  SERVER_MAX_HEADER_BYTES: {{ .Values.env.global.SERVER_MAX_HEADER_BYTES | quote }}
  LOG_LEVEL: {{ .Values.env.global.LOG_LEVEL | quote }}

  # Database Configuration
  DATABASE_HOST: {{ .Values.externalDatabase.postgresql.host | quote }}
  DATABASE_PORT: {{ .Values.externalDatabase.postgresql.port | quote }}
  DATABASE_USERNAME: {{ .Values.externalDatabase.postgresql.username | quote }}
  DATABASE_SSL_MODE: {{ .Values.externalDatabase.postgresql.sslMode | quote }}
  DATABASE_TIMEZONE: {{ .Values.externalDatabase.postgresql.timezone | quote }}
  DATABASE_MAX_OPEN_CONNS: {{ .Values.externalDatabase.postgresql.maxOpenConns | quote }}
  DATABASE_MAX_IDLE_CONNS: {{ .Values.externalDatabase.postgresql.maxIdleConns | quote }}
  DATABASE_CONN_MAX_LIFETIME: {{ .Values.externalDatabase.postgresql.connMaxLifetime | quote }}
  DATABASE_CONN_MAX_IDLE_TIME: {{ .Values.externalDatabase.postgresql.connMaxIdleTime | quote }}

  # Redis Configuration
  REDIS_HOST: {{ .Values.externalDatabase.redis.host | quote }}
  REDIS_PORT: {{ .Values.externalDatabase.redis.port | quote }}
  REDIS_POOL_SIZE: {{ .Values.externalDatabase.redis.poolSize | quote }}
  REDIS_MIN_IDLE_CONNS: {{ .Values.externalDatabase.redis.minIdleConns | quote }}
  REDIS_MAX_RETRIES: {{ .Values.externalDatabase.redis.maxRetries | quote }}
  REDIS_DIAL_TIMEOUT: {{ .Values.externalDatabase.redis.dialTimeout | quote }}
  REDIS_READ_TIMEOUT: {{ .Values.externalDatabase.redis.readTimeout | quote }}
  REDIS_WRITE_TIMEOUT: {{ .Values.externalDatabase.redis.writeTimeout | quote }}

  # JWT Configuration
  JWT_ACCESS_TOKEN_TTL: {{ .Values.env.jwt.JWT_ACCESS_TOKEN_TTL | quote }}
  JWT_REFRESH_TOKEN_TTL: {{ .Values.env.jwt.JWT_REFRESH_TOKEN_TTL | quote }}
  JWT_ISSUER: {{ .Values.env.jwt.JWT_ISSUER | quote }}
  JWT_AUDIENCE: {{ .Values.env.jwt.JWT_AUDIENCE | quote }}

  # Rate Limiting Configuration
  RATE_LIMIT_RPS: {{ .Values.env.rateLimit.RATE_LIMIT_RPS | quote }}
  RATE_LIMIT_BURST: {{ .Values.env.rateLimit.RATE_LIMIT_BURST | quote }}
  RATE_LIMIT_PERIOD: {{ .Values.env.rateLimit.RATE_LIMIT_PERIOD | quote }}
  RATE_LIMIT_CLEANUP_AFTER: {{ .Values.env.rateLimit.RATE_LIMIT_CLEANUP_AFTER | quote }}

  # CORS Configuration
  CORS_ALLOWED_ORIGINS: {{ .Values.env.cors.CORS_ALLOWED_ORIGINS | quote }}
  CORS_ALLOWED_METHODS: {{ .Values.env.cors.CORS_ALLOWED_METHODS | quote }}
  CORS_ALLOWED_HEADERS: {{ .Values.env.cors.CORS_ALLOWED_HEADERS | quote }}
  CORS_ALLOW_CREDENTIALS: {{ .Values.env.cors.CORS_ALLOW_CREDENTIALS | quote }}
  CORS_MAX_AGE: {{ .Values.env.cors.CORS_MAX_AGE | quote }}

  # Internal Service URLs (Kubernetes DNS-based service discovery)
  USER_SERVICE_URL: "http://{{ include "bus-booking.fullname" . }}-user-service"
  TRIP_SERVICE_URL: "http://{{ include "bus-booking.fullname" . }}-trip-service"
  BOOKING_SERVICE_URL: "http://{{ include "bus-booking.fullname" . }}-booking-service"
  PAYMENT_SERVICE_URL: "http://{{ include "bus-booking.fullname" . }}-payment-service"

  # Legacy aliases for backward compatibility
  USER_INTERNAL_URL: "http://{{ include "bus-booking.fullname" . }}-user-service"
  TRIPS_INTERNAL_URL: "http://{{ include "bus-booking.fullname" . }}-trip-service"
  TRIP_INTERNAL_URL: "http://{{ include "bus-booking.fullname" . }}-trip-service"
  BOOKINGS_INTERNAL_URL: "http://{{ include "bus-booking.fullname" . }}-booking-service"
  BOOKING_INTERNAL_URL: "http://{{ include "bus-booking.fullname" . }}-booking-service"
  PAYMENTS_INTERNAL_URL: "http://{{ include "bus-booking.fullname" . }}-payment-service"
  PAYMENT_INTERNAL_URL: "http://{{ include "bus-booking.fullname" . }}-payment-service"